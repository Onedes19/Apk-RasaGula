<!DOCTYPE html>
{% load static %}
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Mengimpor stylesheet dan font untuk halaman deteksi -->
    <link rel="stylesheet" href="{% static 'deteksi.css'%}" />
    <link
      rel="shortcut icon"
      href="{% static 'images/rasagula.svg '%}"
      type="image/svg+xml"
    />
    <title>Deteksi</title>
    <!-- Mengimpor stylesheet dan font untuk halaman deteksi -->
    <link rel="stylesheet" href="{% static 'dashboard/all.min.css' %}" />
    <!-- Mengimpor stylesheet dan font untuk halaman deteksi -->
    <link rel="stylesheet" href="{% static 'dashboard/framework.css'%}" />
    <!-- Mengimpor stylesheet dan font untuk halaman deteksi -->
    <link rel="stylesheet" href="{% static 'dashboard/master.css'%}" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="shortcut icon"
      href="{% static 'images/rasagula.svg' %}"
      type="image/svg+xml"
    />
    <script
      src="https://kit.fontawesome.com/0d6199263a.js"
      crossorigin="anonymous"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;500&display=swap"
      rel="stylesheet"
    />

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800&display=swap");
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body,
      input,
      textarea {
        font-family: "Poppins", sans-serif;
      }

      .popup-container.visible {
        display: block;
      }
      body::-webkit-scrollbar {
        width: initial;
      }
      body::-webkit-scrollbar-track {
        background: initial;
      }
      body::-webkit-scrollbar-thumb {
        background: initial;
      }
      body::-webkit-scrollbar-thumb:hover {
        background-color: initial;
      }
      .popup-container {
        position: fixed;
        top: 0;
        display: none;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
        justify-content: center;
        align-items: center;
        z-index: 999;
      }
      .form.deteksi {
        max-width: 800px;
        max-height: 800px;
        position: absolute;
        left: 16.3%;
        top: 13.5%;
      }
      .negative {
        background: linear-gradient(45deg, #5976e2, #3d50c3);
      }
      .positive {
        background: linear-gradient(45deg, #cf443c, #b30523);
      }
      .contact-form:before {
        content: "";
        position: absolute;
        display: none;
      }
      .contact-form.negative {
        border-radius: 12px;
      }
      .input-container label {
        position: absolute;
        top: 50%;
        left: 15px;
        transform: translateY(-50%);
        padding: 0 0.4rem;
        color: #fafafa;
        font-size: 0.9rem;
        font-weight: 400;
        pointer-events: none;
        z-index: 1000;
        transition: 0.5s;
      }
      .container {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 20px;
      }
      .form-container {
        width: 60%;
      }
      .info-box {
        background: #f9e8e1;
        padding: 15px;
        border-radius: 8px;
        font-size: 14px;
        color: #333;
        width: 30%;
        min-width: 280px;
        position: absolute;
        top: 105.5px;
        right: 40px;
        box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        text-align: justify; /* Menjadikan teks rata kanan-kiri */
      }
      .info-box h3 {
        margin-bottom: 10px;
      }
      .input-container {
        position: relative;
      }
      .info-icon {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        color: white;
        font-size: 16px;
        cursor: pointer;
      }
      .tooltip {
        position: absolute;
        right: 35px;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(255, 255, 255, 0.9);
        color: black;
        font-size: 14px;
        padding: 8px 10px;
        border-radius: 6px;
        white-space: nowrap;
        visibility: hidden;
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
        z-index: 10;
        box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.2);
        border: 1px solid #ccc;
      }
      .input-container:hover .tooltip {
        visibility: visible;
        opacity: 1;
      }
      .error-box {
        background: #f0e1cc;
        padding: 15px;
        border-radius: 8px;
        font-size: 14px;
        color: #333;
        width: 30%;
        min-width: 280px;
        position: absolute;
        top: 230px;
        right: 40px;
        box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        text-align: justify;
      }
      .error-box h3 {
        margin-bottom: 10px;
        font-size: 16px;
        font-weight: bold;
      }
    </style>

    <script
      src="https://kit.fontawesome.com/64d58efce2.js"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <!-- Container utama untuk sidebar dan konten deteksi -->
    <div class="page d-flex">
      <!-- Sidebar navigasi -->
      <div class="sidebar bg-white p-20 p-relative">
        <h3 class="p-relative txt-c mt-0">Selamat Datang {{username}}!</h3>
        <ul>
          <li>
            <a
              class="active d-flex align-center fs-14 c-black rad-6 p-10"
              href="{% url 'deteksi' %}"
            >
              <i class="fa-solid fa-magnifying-glass-chart"></i>
              <span>Deteksi</span>
            </a>
          </li>
          <li>
            <a
              class="d-flex align-center fs-14 c-black rad-6 p-10"
              href="{% url 'pola-makan' %}"
            >
              <i class="fa-solid fa-utensils"></i>
              <span>Pola Makan</span>
            </a>
          </li>
          <li>
            <a
              class="d-flex align-center fs-14 c-black rad-6 p-10"
              href="{% url 'home' %}"
            >
              <i class="fa-solid fa-circle-arrow-left"></i>
              <span>Keluar</span>
            </a>
          </li>
        </ul>
      </div>

      <div class="content w-full">
        <h1 class="p-relative">Deteksi</h1>

        <div class="form deteksi">
          <div class="contact-info">
            <h3 class="title">Evaluasi risiko diabetes</h3>

            <img
              src="{% static 'images/deteksi.png'%}"
              alt=""
              width="400px"
              height="400px"
              id="bg"
            />
          </div>

          <div class="contact-form">
            <span class="circle one"></span>
            <span class="circle two"></span>

            <!-- Formulir input untuk deteksi diabetes -->
            <form action="{% url 'result' %}" method="GET" autocomplete="off">
              {% csrf_token %}
              <div class="input-container">
                <input type="text" class="input" name="n1" required />
                <label>Jumlah Kehamilan</label>
                <i
                  class="fas fa-info-circle info-icon"
                  onclick="showInfo('jumlah_kehamilan')"
                ></i>
              </div>
              <div class="input-container">
                <input type="text" class="input" name="n2" required />
                <label>Gula Darah (mg/dl)</label>
                <i
                  class="fas fa-info-circle info-icon"
                  onclick="showInfo('gula_darah')"
                ></i>
              </div>
              <div class="input-container">
                <input type="text" class="input" name="n3" required />
                <label>Tekanan Darah (mmHg)</label>
                <i
                  class="fas fa-info-circle info-icon"
                  onclick="showInfo('tekanan_darah')"
                ></i>
              </div>
              <div class="input-container">
                <input type="text" class="input" name="n4" required />
                <label>Lingkar Perut (cm)</label>
                <i
                  class="fas fa-info-circle info-icon"
                  onclick="showInfo('lingkar_perut')"
                ></i>
              </div>
              <div class="input-container">
                <input type="text" class="input" name="n5" required />
                <label>Insulin (mUI/ml)</label>
                <i
                  class="fas fa-info-circle info-icon"
                  onclick="showInfo('insulin')"
                ></i>
              </div>
              <div class="input-container">
                <input type="text" class="input" name="n6" required />
                <label>Indeks Massa Tubuh (IMT)</label>
                <i
                  class="fas fa-info-circle info-icon"
                  onclick="showInfo('imt')"
                ></i>
              </div>
              <div class="input-container">
                <input type="text" class="input" name="n7" required />
                <label>Riwayat Keluarga</label>
                <i
                  class="fas fa-info-circle info-icon"
                  onclick="showInfo('riwayat_keluarga')"
                ></i>
              </div>
              <div class="input-container">
                <input type="text" class="input" name="n8" required />
                <label>Usia</label>
                <i
                  class="fas fa-info-circle info-icon"
                  onclick="showInfo('usia')"
                ></i>
              </div>
              <input
                type="submit"
                value="Deteksi"
                class="btn"
                id="deteksi-btn"
              />
            </form>
          </div>
        </div>
        <!-- Kotak Informasi Variabel -->
        <div class="info-box" id="info-box">
          <h3>ℹ Informasi Variabel Deteksi</h3>
          <p id="info-text">Klik ikon (ℹ) untuk melihat informasi.</p>
        </div>

        <!-- Kotak Pesan Error -->
        {% if error %}
        <div class="error-box" id="error-box">
          <h3>⚠ Input Tidak Valid</h3>
          <p>{{ error }}</p>
        </div>
        {% endif %}
      </div>
      <!-- Popup hasil deteksi berdasarkan nilai input -->
      <div class="popup-container" id="popupcontainertest" width="100%"></div>
    </div>
    <!-- Script untuk mengatur fokus dan hasil deteksi -->
    <script>
      const inputs = document.querySelectorAll(".input");

      function focusFunc() {
        let parent = this.parentNode;
        parent.classList.add("focus");
      }

      function blurFunc() {
        let parent = this.parentNode;
        if (this.value == "") {
          parent.classList.remove("focus");
        }
      }

      inputs.forEach((input) => {
        input.addEventListener("focus", focusFunc);
        input.addEventListener("blur", blurFunc);
      });

      window.onload = () => {
        var result = "{{ result}}";
        var probability = "{{ probability }}";
        var val1 = "{{val1}}";
        var val2 = "{{val2}}";
        var val3 = "{{val3}}";
        var val4 = "{{val4}}";
        var val5 = "{{val5}}";
        var val6 = "{{val6}}";
        var val7 = "{{val7}}";
        var val8 = "{{val8}}";

        if (result === "true") {
          var success = document.getElementById("popupcontainertest");
          console.log("result true");
          console.log("val8 :" + val8);
          console.log("val6:" + val6);
          success.innerHTML = `
      <form class="contact-form positive" style='position:fixed; top: 7%; left: 30%;'>
        <h2 style="color: white; text-align: center;">Hasil Deteksi Anda Menunjukkan Positif!</h4>
        <h3 style="color: white; text-align: center;">Kemungkinan: ${probability}%</h3>
        <div class="input-container">
          <input type="text" class="input"  name="n1" value="${val1}" readonly/>
        </div>
        <div class="input-container">
          <input type="text" class="input"  name="n2" value="${val2}" readonly/>
        </div>
        <div class="input-container">
          <input type="text" class="input" name="n3" value="${val3}" readonly/>
        </div>
        <div class="input-container">
          <input type="text" class="input" name="n4" value="${val4}" readonly/>
        </div>
        <div class="input-container">
          <input type="text" class="input" name="n5" value="${val5}" readonly/>
        </div>
        <div class="input-container">
          <input type="text"  class="input"  value="${val6}" readonly name="n6" />
        </div>
        <div class="input-container">
          <input type="text" class="input"  name="n7" value="${val7}" readonly/>
        </div>
        <div class="input-container">
          <input type="text" class="input"  value="${val8}" readonly>
        </div>
      </form>
    `;
          success.classList.add("visible");

          // Tutup popup ketika pengguna mengklik di luar popup
          window.addEventListener("click", function (event) {
            if (event.target === success) {
              success.classList.remove("visible");
            }
          });
        } else if (result === "false") {
          var success = document.getElementById("popupcontainertest");
          console.log("result false");
          success.innerHTML = `
      <form class="contact-form negative" style='position:fixed; top: 7%; left: 30%;'>
        <h2 style="color: white; text-align: center;"> Hasil Deteksi Anda Menunjukkan Negatif! </h2>
        <h3 style="color: white; text-align: center;">Kemungkinan: ${probability}%</h3>
        <div class="input-container">
          <input type="text" class="input"  name="n1" value="${val1}" readonly/>
        </div>
        <div class="input-container">
          <input type="text" class="input"  name="n2" value="${val2}" readonly/>
        </div>
        <div class="input-container">
          <input type="text" class="input" name="n3" value="${val3}" readonly/>
        </div>
        <div class="input-container">
          <input type="text" class="input" name="n4" value="${val4}" readonly/>
        </div>
        <div class="input-container">
          <input type="text" class="input" name="n5" value="${val5}" readonly/>
        </div>
        <div class="input-container">
          <input type="text" class="input"  value="${val6}" readonly name="n6" />
        </div>
        <div class="input-container">
          <input type="text" class="input"  name="n7" value="${val7}" readonly/>
        </div>
        <div class="input-container">
          <input type="text" class="input"  value="${val8}" readonly>
        </div>
      </form>
    `;
          success.classList.add("visible");

          // Tutup popup ketika pengguna mengklik di luar popup
          window.addEventListener("click", function (event) {
            if (event.target === success) {
              success.classList.remove("visible");
            }
          });
        } else if (result === "none") {
          console.log("Kesalahan pada tampilan");
        }
      };
      const infoData = {
        jumlah_kehamilan:
          "Masukkan jumlah total kehamilan yang pernah dialami, termasuk keguguran. Semakin banyak kehamilan, semakin besar risiko diabetes gestasional. Jika lebih dari 3 kali, disarankan rutin memeriksa kadar gula darah dan menjaga pola makan sehat.",
        gula_darah:
          "Masukkan kadar gula darah dalam mg/dL. Normalnya, kadar gula darah puasa di bawah 100 mg/dL. Jika lebih dari 126 mg/dL, bisa menjadi tanda diabetes. Jaga pola makan dan rutin periksa kadar gula darah untuk kesehatan tubuh.",
        tekanan_darah:
          "Masukkan tekanan darah sistolik dalam mmHg. Normalnya di bawah 120 mmHg. Jika lebih dari 140 mmHg, bisa meningkatkan risiko hipertensi dan komplikasi diabetes. Kontrol tekanan darah dengan pola hidup sehat dan rutin berolahraga.",
        lingkar_perut:
          "Masukkan ukuran lingkar perut dalam cm. Normalnya, tidak lebih dari 90 cm untuk pria dan 80 cm untuk wanita. Lingkar perut yang berlebih dapat meningkatkan risiko diabetes, jadi jaga pola makan dan tetap aktif bergerak.",
        insulin:
          "Masukkan kadar insulin dalam mUI/ml. Insulin membantu mengatur kadar gula darah. Normalnya berkisar 5–60 mUI/ml. Pada individu dengan diabetes, kadar insulin cenderung lebih tinggi, yaitu 61–355 mUI/ml. Pola hidup sehat membantu menjaga keseimbangan insulin.",
        imt: "Masukkan nilai IMT (Indeks Massa Tubuh). IMT dihitung dari berat badan (kg) dibagi tinggi badan (m) kuadrat. Normalnya 18,5–24,9. Jika lebih dari 25, termasuk kelebihan berat badan dan berisiko diabetes. Jaga berat badan dengan pola makan sehat dan olahraga.",
        riwayat_keluarga:
          "Masukkan 0 jika tidak memiliki riwayat diabetes, dan 1 jika ada riwayat dalam keluarga. Risiko diabetes lebih tinggi jika orang tua atau saudara kandung mengalaminya. Gaya hidup sehat tetap penting untuk pencegahan.",
        usia: "Masukkan usia dalam tahun. Setelah usia 45 tahun, risiko diabetes meningkat karena perubahan metabolisme. Jaga pola makan, tetap aktif, dan lakukan pemeriksaan rutin untuk menjaga kadar gula darah tetap stabil.",
      };
      function showInfo(field) {
        document.getElementById("info-text").innerText =
          infoData[field] || "Informasi tidak tersedia.";
      }
      document.addEventListener("DOMContentLoaded", function () {
        const errorBox = document.getElementById("error-box");
        if (errorBox) {
          setTimeout(() => {
            errorBox.style.display = "none";
          }, 3000); // Pesan error akan hilang setelah 5 detik
        }
      });
    </script>
  </body>
</html>
